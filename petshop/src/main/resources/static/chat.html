<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1:1 Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>1:1 Chat</h1>
<div>
    <select id="senderId">
        <option value="1">Sender 1</option>
        <option value="2">Sender 2</option>
        <!-- Add more options as needed -->
    </select>
    <select id="recipientId">
        <option value="1">Recipient 1</option>
        <option value="2">Recipient 2</option>
        <!-- Add more options as needed -->
    </select>
    <input type="text" id="message" placeholder="Message">
    <button onclick="sendMessage()">Send Message</button>
</div>
<div>
    <h2>Received Messages:</h2>
    <ul id="messages"></ul>
</div>

<script>
    var stompClient = null;

    function connect() {
        var socket = new SockJS('/stomp/chat');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);

            // Subscribe to messages
            var recipientId = document.getElementById('recipientId').value;
            stompClient.subscribe('/user/' + recipientId + '/queue/messages', function (message) {
                console.log("Received message:", message.body);
                showMessage(JSON.parse(message.body));
            });
        }, function (error) {
            console.error('Connection error:', error);
        });
    }

    function sendMessage() {
        var senderId = document.getElementById('senderId').value;
        var recipientId = document.getElementById('recipientId').value;
        var message = document.getElementById('message').value;

        if (stompClient && stompClient.connected) {
            stompClient.send("/app/send", {}, JSON.stringify({
                senderId: senderId,
                recipientId: recipientId,
                message: message
            }));
            console.log("Message sent:", message);
        } else {
            console.error('WebSocket is not connected.');
        }
    }

    function showMessage(message) {
        var messages = document.getElementById('messages');
        var messageElement = document.createElement('li');
        messageElement.appendChild(document.createTextNode(message.senderNickName + ": " + message.message + " (" + message.timestamp + ")"));
        messages.appendChild(messageElement);
    }

    connect();
</script>
</body>
</html>
